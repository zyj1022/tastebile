# å‡½æ•°å¼ç»„ä»¶ä¸ç±»ç»„ä»¶æœ‰ä½•ä¸åŒï¼Ÿ

ä¸Reactç±»ç»„ä»¶ç›¸æ¯”ï¼ŒReactå‡½æ•°å¼ç»„ä»¶ç©¶ç«Ÿæœ‰ä½•ä¸åŒï¼Ÿ

é™¤äº†å›ç­”classç»„ä»¶æä¾›æ›´å¤šçš„ç‰¹æ€§ï¼Œæ¯”å¦‚ç”Ÿå‘½å‘¨æœŸç­‰ï¼Œç°åœ¨å‡½æ•°ç»„ä»¶ç”¨äº `hooks` ä¹Ÿå¯ä»¥æœ‰ç±»ä¼¼çš„åŠŸèƒ½.

æˆ–è€…ä¼šæœ‰æ€§èƒ½å·®å¼‚ï¼Œä½†æ€§èƒ½ä¸»è¦å–å†³äºä»£ç çš„ä½œç”¨ï¼Œä¸ä»…ä»…æ˜¯ç»„ä»¶çš„æ„æˆæ–¹å¼ï¼Œåœ¨å®è·µè§‚å¯Ÿä¸­ï¼Œæ ¹æ®ä¼˜åŒ–ç­–ç•¥[ä¸åŒ](https://zh-hans.reactjs.org/docs/hooks-faq.html#are-hooks-slow-because-of-creating-functions-in-render)ï¼Œä½†æ€§èƒ½å·®å¼‚å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚

Reactçš„å‡½æ•°å¼ç»„ä»¶å’Œç±»ç»„ä»¶ä¹‹é—´æ˜¯å¦æœ‰ä»»ä½•æ ¹æœ¬ä¸Šçš„åŒºåˆ«ï¼Ÿå½“ç„¶æœ‰ â€”â€” åœ¨å¿ƒæ™ºæ¨¡å‹ä¸Šã€‚

è¿™é‡Œå°†é˜è¿°å®ƒä»¬ä¹‹é—´çš„æœ€å¤§åŒºåˆ«ã€‚ è‡ªæ¨å‡ºå‡½æ•°å¼ç»„ä»¶ä»¥æ¥ï¼Œå®ƒä¸€ç›´å­˜åœ¨ï¼Œä½†æ˜¯ç»å¸¸è¢«å¿½ç•¥ï¼š


> å‡½æ•°å¼ç»„ä»¶æ•è·äº†æ¸²æŸ“æ‰€ç”¨çš„å€¼ã€‚ï¼ˆFunction components capture the rendered values.ï¼‰


æ³¨æ„ï¼šè¿™ç¯‡æ–‡ç« ä¸æ˜¯å¯¹å‡½æ•°å¼ç»„ä»¶æˆ–è€…ç±»ç»„ä»¶çš„ä»·å€¼åˆ¤æ–­ã€‚æˆ‘åªæ˜¯åœ¨é˜è¿°åœ¨Reactä¸­è¿™ä¸¤ç§ç¼–ç¨‹æ¨¡å‹ä¹‹é—´çš„åŒºåˆ«ã€‚å…³äºæ›´å¹¿æ³›åœ°é‡‡ç”¨å‡½æ•°å¼ç»„ä»¶çš„é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ [Hooks FAQ](https://zh-hans.reactjs.org/docs/hooks-faq.html#adoption-strategy)ã€‚


## ä¸¾ä¸ªç»„ä»¶ ğŸŒ°

æ€è€ƒè¿™ä¸ªç»„ä»¶:

```
function ProfilePage(props) {
  const showMessage = () => {
    alert('Followed ' + props.user);
  };

  const handleClick = () => {
    setTimeout(showMessage, 3000);
  };

  return (
    <button onClick={handleClick}>Follow</button>
  );
}
```

å®ƒæ¸²æŸ“äº†ä¸€ä¸ªåˆ©ç”¨ `setTimeout` æ¥æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚ï¼Œç„¶åæ˜¾ç¤ºä¸€ä¸ªç¡®è®¤è­¦å‘Šçš„æŒ‰é’®ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ `props.user` æ˜¯ `Dan` ï¼Œå®ƒä¼šåœ¨ä¸‰ç§’åæ˜¾ç¤º `Followed Dan`ã€‚éå¸¸ç®€å•ã€‚

ï¼ˆè¯·æ³¨æ„ï¼Œåœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­æˆ‘æ˜¯å¦ç”¨äº†ç®­å¤´å‡½æ•°æˆ–è€…å‡½æ•°å£°æ˜å¹¶ä¸é‡è¦ã€‚function handleClick()ä¹Ÿå°†å®Œå…¨ä»¥åŒæ ·æ–¹å¼æœ‰æ•ˆã€‚ï¼‰

å¦‚æœæ˜¯ç±»ç»„ä»¶æˆ‘ä»¬æ€ä¹ˆå†™ï¼Ÿä¸€ä¸ªç®€å•çš„é‡æ„å¯èƒ½å°±è±¡è¿™æ ·ï¼š

```
class ProfilePage extends React.Component {
  showMessage = () => {
    alert('Followed ' + this.props.user);
  };

  handleClick = () => {
    setTimeout(this.showMessage, 3000);
  };

  render() {
    return <button onClick={this.handleClick}>Follow</button>;
  }
}
```
é€šå¸¸æˆ‘ä»¬è®¤ä¸ºï¼Œè¿™ä¸¤ä¸ªä»£ç ç‰‡æ®µæ˜¯ç­‰æ•ˆçš„ã€‚äººä»¬ç»å¸¸åœ¨è¿™ä¸¤ç§æ¨¡å¼ä¸­è‡ªç”±çš„é‡æ„ä»£ç ï¼Œä½†æ˜¯å¾ˆå°‘æ³¨æ„åˆ°å®ƒä»¬çš„å«ä¹‰ï¼š

![view](../assets/wtf.gif)

ç„¶è€Œï¼Œè¿™ä¸¤ä¸ªä»£ç ç‰‡æ®µè¿˜æ˜¯æœ‰ç•¥å¾®çš„ä¸åŒã€‚ ä»”ç»†çš„çœ‹çœ‹å®ƒä»¬ã€‚ç°åœ¨çœ‹å‡ºä»–ä»¬çš„ä¸åŒäº†å—ï¼Ÿå°±æˆ‘ä¸ªäººè€Œè¨€ï¼Œæˆ‘èŠ±äº†å¥½ä¸€ä¼šå„¿æ‰çœ‹æ˜ç™½è¿™ä¸€ç‚¹ã€‚

æ¥ä¸‹æ¥çš„æ–‡ç« æ˜¯â€œå‰§é€â€ï¼Œå¦‚æœä½ æƒ³è‡ªå·±ææ˜ç™½ï¼Œä½ å¯ä»¥æŸ¥çœ‹è¿™ä¸ª [live demo](https://codesandbox.io/s/pjqnl16lm7)ã€‚ æœ¬æ–‡çš„ç”Ÿè‚²éƒ¨åˆ†è§£é‡Šäº†è¿™é‡Œé¢çš„å·®å¼‚ä»¥åŠé˜è¿°äº†ä¸ºä»€ä¹ˆè¿™å¾ˆé‡è¦ã€‚

åœ¨æˆ‘ä»¬ç»§ç»­ä¹‹å‰ï¼Œæˆ‘æƒ³å¼ºè°ƒä¸€ç‚¹ï¼Œæˆ‘æ‰€æè¿°çš„å·®å¼‚ä¸ React Hooks å®Œå…¨æ— å…³ã€‚ä¸Šé¢çš„ä¾‹å­ä¸­ç”šè‡³æ²¡æœ‰ä½¿ç”¨ Hooksï¼

å®ƒå…¨éƒ¨æ˜¯å…³äº React ä¸­å‡½æ•°å¼ç»„ä»¶ä¸ç±»ç»„ä»¶çš„åŒºåˆ«çš„ã€‚å¦‚æœä½ æ‰“ç®—åœ¨ä½ çš„ React åº”ç”¨ä¸­æ›´é¢‘ç¹åœ°ä½¿ç”¨å‡½æ•°å¼ç»„ä»¶ï¼Œä½ å¯èƒ½éœ€è¦ç†è§£å®ƒã€‚


**æˆ‘ä»¬å°†é€šè¿‡ React åº”ç”¨ç¨‹åºä¸­çš„ä¸€ä¸ªå¸¸è§é”™è¯¯æ¥è¯´æ˜å…¶ä¸­çš„ä¸åŒã€‚**

æ‰“å¼€è¿™ä¸ª [sandbox](https://codesandbox.io/s/pjqnl16lm7) ä¾‹å­ï¼Œ ä½ å°†çœ‹åˆ°ä¸€ä¸ªå½“å‰è´¦å·é€‰æ‹©æ¡†ä»¥åŠä¸¤ä¸ªä¸Šé¢ `ProfilePage` çš„å®ç° â€”â€” æ¯ä¸ªéƒ½æ¸²æŸ“äº†ä¸€ä¸ª Follow æŒ‰é’®ã€‚

å°è¯•æŒ‰ç…§ä»¥ä¸‹é¡ºåºæ¥åˆ†åˆ«ä½¿ç”¨è¿™ä¸¤ä¸ªæŒ‰é’®ï¼š

ç‚¹å‡» å…¶ä¸­æŸä¸€ä¸ª `Follow` æŒ‰é’®ã€‚
åœ¨3ç§’å†… åˆ‡æ¢ é€‰ä¸­çš„è´¦å·ã€‚
æŸ¥çœ‹ å¼¹å‡ºçš„æ–‡æœ¬ã€‚
ä½ å°†çœ‹åˆ°ä¸€ä¸ªå¥‡ç‰¹çš„åŒºåˆ«:

å½“ä½¿ç”¨ å‡½æ•°å¼ç»„ä»¶ å®ç°çš„ `ProfilePage`, å½“å‰è´¦å·æ˜¯ `Dan` æ—¶ç‚¹å‡» `Follow` æŒ‰é’®ï¼Œç„¶åç«‹é©¬åˆ‡æ¢å½“å‰è´¦å·åˆ° `Sophie` ï¼Œå¼¹å‡ºçš„æ–‡æœ¬å°†ä¾æ—§æ˜¯ `'Followed Dan'`ã€‚
å½“ä½¿ç”¨ ç±»ç»„ä»¶ å®ç°çš„ `ProfilePage`, å¼¹å‡ºçš„æ–‡æœ¬å°†æ˜¯ `'Followed Sophie'`

![bug](../assets/bug.gif)

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç¬¬ä¸€ä¸ªè¡Œä¸ºæ˜¯æ­£ç¡®çš„ã€‚
å¦‚æœæˆ‘å…³æ³¨ä¸€ä¸ªäººï¼Œç„¶åå¯¼èˆªåˆ°äº†å¦ä¸€ä¸ªäººçš„è´¦å·ï¼Œæˆ‘çš„ç»„ä»¶ä¸åº”è¯¥æ··æ·†æˆ‘å…³æ³¨äº†è°ã€‚ 
åœ¨è¿™é‡Œï¼Œç±»ç»„ä»¶çš„å®ç°å¾ˆæ˜æ˜¾æ˜¯é”™è¯¯çš„ã€‚

**æ‰€ä»¥ä¸ºä»€ä¹ˆæˆ‘ä»¬çš„ä¾‹å­ä¸­ç±»ç»„ä»¶ä¼šæœ‰è¿™æ ·çš„è¡¨ç°ï¼Ÿ**

è®©æˆ‘ä»¬æ¥ä»”ç»†çœ‹çœ‹æˆ‘ä»¬ç±»ç»„ä»¶ä¸­çš„ showMessage æ–¹æ³•ï¼š

```
class ProfilePage extends React.Component {
  showMessage = () => {
    alert('Followed ' + this.props.user);`
  };
```

è¿™ä¸ªç±»æ–¹æ³•ä» `this.props.user` ä¸­è¯»å–æ•°æ®ã€‚åœ¨ React ä¸­ Props æ˜¯ä¸å¯å˜(immutable)çš„ï¼Œæ‰€ä»¥ä»–ä»¬æ°¸è¿œä¸ä¼šæ”¹å˜ã€‚ç„¶è€Œï¼Œ **`this`** æ˜¯ï¼Œè€Œä¸”æ°¸è¿œæ˜¯ï¼Œå¯å˜ **`(mutable)`** çš„ã€‚

äº‹å®ä¸Šï¼Œè¿™å°±æ˜¯ç±»ç»„ä»¶ `this` å­˜åœ¨çš„æ„ä¹‰ã€‚Reactæœ¬èº«ä¼šéšç€æ—¶é—´çš„æ¨ç§»è€Œæ”¹å˜ï¼Œä»¥ä¾¿ä½ å¯ä»¥åœ¨æ¸²æŸ“æ–¹æ³•ä»¥åŠç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸­å¾—åˆ°æœ€æ–°çš„å®ä¾‹ã€‚

æ‰€ä»¥å¦‚æœåœ¨è¯·æ±‚å·²ç»å‘å‡ºçš„æƒ…å†µä¸‹æˆ‘ä»¬çš„ç»„ä»¶è¿›è¡Œäº†é‡æ–°æ¸²æŸ“ï¼Œ`this.props` å°†ä¼šæ”¹å˜ã€‚`showMessage` æ–¹æ³•ä»ä¸€ä¸ªâ€œè¿‡äºæ–°â€çš„propsä¸­å¾—åˆ°äº† userã€‚

è¿™æš´éœ²äº†ä¸€ä¸ªå…³äºç”¨æˆ·ç•Œé¢æ€§è´¨çš„ä¸€ä¸ªæœ‰è¶£è§‚å¯Ÿã€‚å¦‚æœæˆ‘ä»¬è¯´UIåœ¨æ¦‚å¿µä¸Šæ˜¯å½“å‰åº”ç”¨çŠ¶æ€çš„ä¸€ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆäº‹ä»¶å¤„ç†ç¨‹åºåˆ™æ˜¯æ¸²æŸ“ç»“æœçš„ä¸€éƒ¨åˆ† â€”â€” å°±åƒè§†è§‰è¾“å‡ºä¸€æ ·ã€‚æˆ‘ä»¬çš„äº‹ä»¶å¤„ç†ç¨‹åºâ€œå±äºâ€ä¸€ä¸ªæ‹¥æœ‰ç‰¹å®š `props` å’Œ `state` çš„ç‰¹å®šæ¸²æŸ“ã€‚

ç„¶è€Œï¼Œè°ƒç”¨ä¸€ä¸ªå›è°ƒå‡½æ•°è¯»å– `this.props` çš„ `timeout` ä¼šæ‰“æ–­è¿™ç§å…³è”ã€‚æˆ‘ä»¬çš„ `showMessage` å›è°ƒå¹¶æ²¡æœ‰ä¸ä»»ä½•ä¸€ä¸ªç‰¹å®šçš„æ¸²æŸ“â€œç»‘å®šâ€åœ¨ä¸€èµ·ï¼Œæ‰€ä»¥å®ƒâ€œå¤±å»â€äº†æ­£ç¡®çš„ `props` ã€‚ä» `this` ä¸­è¯»å–æ•°æ®çš„è¿™ç§è¡Œä¸ºï¼Œåˆ‡æ–­äº†è¿™ç§è”ç³»ã€‚

----

**è®©æˆ‘ä»¬å‡è®¾å‡½æ•°å¼ç»„ä»¶ä¸å­˜åœ¨ã€‚æˆ‘ä»¬å°†å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ**

æˆ‘ä»¬æƒ³è¦ä»¥æŸç§æ–¹å¼â€œä¿®å¤â€æ‹¥æœ‰æ­£ç¡® `props` çš„æ¸²æŸ“ä¸è¯»å–è¿™äº› `props` çš„ `showMessage` å›è°ƒä¹‹é—´çš„è”ç³»ã€‚åœ¨æŸä¸ªåœ°æ–¹propsè¢«å¼„ä¸¢äº†ã€‚

ä¸€ç§æ–¹æ³•æ˜¯åœ¨è°ƒç”¨äº‹ä»¶ä¹‹å‰è¯»å–this.propsï¼Œç„¶åå°†ä»–ä»¬æ˜¾å¼åœ°ä¼ é€’åˆ°timeoutå›è°ƒå‡½æ•°ä¸­å»ï¼š

```
class ProfilePage extends React.Component {
  showMessage = (user) => {
    alert('Followed ' + user);
  };

  handleClick = () => {
    const {user} = this.props;
    setTimeout(() => this.showMessage(user), 3000);
  };

  render() {
    return <button onClick={this.handleClick}>Follow</button>;
  }
}
```
è¿™ç§æ–¹æ³• ä¼šèµ·ä½œç”¨ã€‚ç„¶è€Œï¼Œè¿™ç§æ–¹æ³•ä½¿å¾—ä»£ç æ˜æ˜¾å˜å¾—æ›´åŠ å†—é•¿ï¼Œå¹¶ä¸”éšç€æ—¶é—´æ¨ç§»å®¹æ˜“å‡ºé”™ã€‚

- å¦‚æœæˆ‘ä»¬éœ€è¦çš„ä¸æ­¢æ˜¯ä¸€ä¸ªpropsæ€ä¹ˆåŠï¼Ÿ
- å¦‚æœæˆ‘ä»¬è¿˜éœ€è¦è®¿é—® `state` æ€ä¹ˆåŠï¼Ÿ
- å¦‚æœ showMessage è°ƒç”¨äº†å¦ä¸€ä¸ªæ–¹æ³•ï¼Œç„¶åé‚£ä¸ªæ–¹æ³•ä¸­è¯»å–äº† this.props.something æˆ–è€… this.state.somethingï¼Œæˆ‘ä»¬åˆå°†é‡åˆ°åŒæ ·çš„é—®é¢˜ã€‚
ç„¶åæˆ‘ä»¬ä¸å¾—ä¸å°† `this.props` å’Œ `this.state` ä»¥å‡½æ•°å‚æ•°çš„å½¢å¼åœ¨è¢« `showMessage` è°ƒç”¨çš„æ¯ä¸ªæ–¹æ³•ä¸­ä¸€è·¯ä¼ é€’ä¸‹å»ã€‚

è¿™æ ·çš„åšæ³•ç ´åäº†ç±»æä¾›çš„å·¥ç¨‹å­¦ã€‚åŒæ—¶è¿™ä¹Ÿå¾ˆéš¾è®©äººå»è®°ä½ä¼ é€’çš„å˜é‡æˆ–è€…å¼ºåˆ¶æ‰§è¡Œï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆäººä»¬æ€»æ˜¯åœ¨è§£å†³bugsã€‚

åŒæ ·çš„ï¼Œåœ¨ `handleClick` ä¸­å†…è”åœ°å†™ `alert` ä»£ç ä¹Ÿæ— æ³•è§£å†³é—®é¢˜ã€‚

æˆ‘ä»¬å¸Œæœ›ä»¥å…è®¸å°†å…¶æ‹†åˆ†ä¸ºå¤šä¸ªæ–¹æ³•çš„æ–¹å¼æ¥æ„é€ ç»„ç»‡ä»£ç ï¼Œä½†åŒæ—¶ä¹Ÿèƒ½è¯»å–ä¸æŸæ¬¡ç»„ä»¶è°ƒç”¨å½¢æˆçš„æ¸²æŸ“ç»“æœå¯¹åº”çš„propså’Œstateã€‚è¿™ä¸ªé—®é¢˜å¹¶ä¸æ˜¯Reactæ‰€ç‹¬æœ‰çš„ â€”â€” ä½ å¯ä»¥åœ¨ä»»ä½•ä¸€ä¸ªå°†æ•°æ®æ”¾å…¥ç±»ä¼¼ `this` è¿™æ ·çš„å¯å˜å¯¹è±¡ä¸­çš„UIåº“ä¸­é‡ç°å®ƒã€‚

**æˆ–è®¸ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ„é€ å‡½æ•°ä¸­ç»‘å®šæ–¹æ³•ï¼Ÿ**

```
class ProfilePage extends React.Component {
  constructor(props) {
    super(props);
    this.showMessage = this.showMessage.bind(this);
    this.handleClick = this.handleClick.bind(this);
  }

  showMessage() {
    alert('Followed ' + this.props.user);
  }

  handleClick() {
    setTimeout(this.showMessage, 3000);
  }

  render() {
    return <button onClick={this.handleClick}>Follow</button>;
  }
}
```
ä¸ï¼Œè¿™æ²¡æœ‰è§£å†³ä»»ä½•é—®é¢˜ã€‚è®°ä½ï¼Œæˆ‘ä»¬é¢å¯¹çš„é—®é¢˜æ˜¯æˆ‘ä»¬ä» `this.props `ä¸­è¯»å–æ•°æ®å¤ªè¿Ÿäº†â€”â€”è¯»å–æ—¶å·²ç»ä¸æ˜¯æˆ‘ä»¬æ‰€éœ€è¦ä½¿ç”¨çš„ä¸Šä¸‹æ–‡äº†ï¼ç„¶è€Œï¼Œå¦‚æœæˆ‘ä»¬èƒ½åˆ©ç”¨**JavaScripté—­åŒ…çš„è¯é—®é¢˜å°†è¿åˆƒè€Œè§£**ã€‚


é€šå¸¸æ¥è¯´æˆ‘ä»¬ä¼šé¿å…ä½¿ç”¨é—­åŒ…ï¼Œå› ä¸ºå®ƒä¼šè®©æˆ‘ä»¬éš¾ä»¥æƒ³è±¡ä¸€ä¸ªå¯èƒ½ä¼šéšç€æ—¶é—´æ¨ç§»è€Œå˜åŒ–çš„å˜é‡ã€‚ä½†æ˜¯åœ¨Reactä¸­ï¼Œpropså’Œstateæ˜¯ä¸å¯å˜å¾—ï¼ï¼ˆæˆ–è€…è¯´ï¼Œåœ¨æˆ‘ä»¬çš„å¼ºçƒˆæ¨èä¸­æ˜¯ä¸å¯å˜å¾—ã€‚ï¼‰è¿™å°±æ¶ˆé™¤äº†é—­åŒ…çš„ä¸€ä¸ªä¸»è¦ç¼ºé™·ã€‚

è¿™å°±æ„å‘³ç€å¦‚æœä½ åœ¨ä¸€æ¬¡ç‰¹å®šçš„æ¸²æŸ“ä¸­æ•è·é‚£ä¸€æ¬¡æ¸²æŸ“æ‰€ç”¨çš„ `props` æˆ–è€… `state` ï¼Œä½ ä¼šå‘ç°ä»–ä»¬æ€»æ˜¯ä¼šä¿æŒä¸€è‡´ï¼Œå°±å¦‚åŒä½ çš„é¢„æœŸé‚£æ ·ï¼š

```
class ProfilePage extends React.Component {
  render() {
    // Capture the props!
    const props = this.props;

    // Note: we are *inside render*.
    // These aren't class methods.
    const showMessage = () => {
      alert('Followed ' + props.user);
    };

    const handleClick = () => {
      setTimeout(showMessage, 3000);
    };

    return <button onClick={handleClick}>Follow</button>;
  }
}
```
ä½ åœ¨æ¸²æŸ“çš„æ—¶å€™å°±å·²ç»â€œæ•è·â€äº† `props` ï¼š

è¿™æ ·ï¼Œåœ¨å®ƒå†…éƒ¨çš„ä»»ä½•ä»£ç ï¼ˆåŒ…æ‹¬showMessageï¼‰éƒ½ä¿è¯å¯ä»¥å¾—åˆ°è¿™ä¸€æ¬¡ç‰¹å®šæ¸²æŸ“æ‰€ä½¿ç”¨çš„propsã€‚
Reactå†ä¹Ÿä¸ä¼šâ€œåŠ¨æˆ‘ä»¬çš„å¥¶é…ªâ€ã€‚

ç„¶åæˆ‘ä»¬å¯ä»¥åœ¨é‡Œé¢æ·»åŠ ä»»æ„å¤šçš„è¾…åŠ©å‡½æ•°ï¼Œå®ƒä»¬éƒ½ä¼šä½¿ç”¨è¢«æ•è·çš„propså’Œstateã€‚é—­åŒ…ä¸‡å²ï¼

----

ä¸Šé¢çš„ä¾‹å­æ˜¯æ­£ç¡®çš„ï¼Œä½†æ˜¯çœ‹èµ·æ¥å¾ˆå¥‡æ€ªã€‚

å¦‚æœä½ åœ¨renderæ–¹æ³•ä¸­å®šä¹‰å„ç§å‡½æ•°ï¼Œè€Œä¸æ˜¯ä½¿ç”¨classçš„æ–¹æ³•ï¼Œé‚£ä¹ˆä½¿ç”¨ç±»çš„æ„ä¹‰åœ¨å“ªé‡Œï¼Ÿ

äº‹å®ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ é™¤ç±»çš„â€œåŒ…è£¹â€æ¥ç®€åŒ–ä»£ç ï¼š

**è¯»è€…æ³¨ï¼šå®é™…æ˜¯å°† class ç»„ä»¶å˜å½¢ä¸º function ç»„ä»¶äº†ğŸ™‚**

```
function ProfilePage(props) {
  const showMessage = () => {
    alert('Followed ' + props.user);
  };

  const handleClick = () => {
    setTimeout(showMessage, 3000);
  };

  return (
    <button onClick={handleClick}>Follow</button>
  );
}
```

å°±åƒä¸Šé¢è¿™æ ·ï¼Œ`props` ä»æ—§è¢«æ•è·äº† â€”â€” Reactå°†å®ƒä»¬ä½œä¸ºå‚æ•°ä¼ é€’ã€‚

ä¸åŒäº `this` ï¼Œ `props` å¯¹è±¡æœ¬èº«æ°¸è¿œä¸ä¼šè¢«Reactæ”¹å˜ã€‚

å¦‚æœä½ åœ¨å‡½æ•°å®šä¹‰ä¸­è§£æ„ `props` ï¼Œé‚£å°†æ›´åŠ æ˜æ˜¾ï¼š

```
function ProfilePage({ user }) {
  const showMessage = () => {
    alert('Followed ' + user);
  };

  const handleClick = () => {
    setTimeout(showMessage, 3000);
  };

  return (
    <button onClick={handleClick}>Follow</button>
  );
}
```

å½“çˆ¶ç»„ä»¶ä½¿ç”¨ä¸åŒçš„ `props` æ¥æ¸²æŸ“ `ProfilePage` æ—¶ï¼ŒReactä¼šå†æ¬¡è°ƒç”¨ `ProfilePage` å‡½æ•°ã€‚

ä½†æ˜¯æˆ‘ä»¬ç‚¹å‡»çš„äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œâ€œå±äºâ€å…·æœ‰è‡ªå·±çš„ `user` å€¼çš„ä¸Šä¸€æ¬¡æ¸²æŸ“ï¼Œå¹¶ä¸”showMessageå›è°ƒå‡½æ•°ä¹Ÿèƒ½è¯»å–åˆ°è¿™ä¸ªå€¼ã€‚å®ƒä»¬éƒ½ä¿æŒå®Œå¥½æ— æŸã€‚

è¿™å°±æ˜¯ä¸ºä»€ä¹ˆï¼Œåœ¨ä¸Šé¢é‚£ä¸ªdemoçš„å‡½æ•°å¼ç‰ˆæœ¬ä¸­ï¼Œç‚¹å‡»å…³æ³¨Sophieçš„è´¦å·ï¼Œç„¶åæ”¹å˜é€‰æ‹©ä¸ºSunilä»æ—§ä¼šå¼¹å‡º`'Followed Sophie'`ï¼š

![bug](../assets/fix.gif)

è¿™ä¸ªè¡Œä¸ºå±•ç°æ˜¯æ­£ç¡®çš„.

ç°åœ¨æˆ‘ä»¬æ˜ç™½äº†Reactä¸­å‡½æ•°å¼ç»„ä»¶å’Œç±»ç»„ä»¶ä¹‹é—´çš„å·¨å¤§å·®åˆ«ï¼š

> å‡½æ•°å¼ç»„ä»¶æ•è·äº†æ¸²æŸ“æ‰€ä½¿ç”¨çš„å€¼ã€‚

---

ä½¿ç”¨Hooksï¼ŒåŒæ ·çš„åŸåˆ™ä¹Ÿé€‚ç”¨äºstateã€‚ çœ‹è¿™ä¸ªä¾‹å­ï¼š

```
function MessageThread() {
  const [message, setMessage] = useState('');

  const showMessage = () => {
    alert('You said: ' + message);
  };

  const handleSendClick = () => {
    setTimeout(showMessage, 3000);
  };

  const handleMessageChange = (e) => {
    setMessage(e.target.value);
  };

  return (
    <>
      <input value={message} onChange={handleMessageChange} />
      <button onClick={handleSendClick}>Send</button>
    </>
  );
}
```

ï¼ˆ[è¿™æ˜¯æ¼”ç¤ºdemo](https://codesandbox.io/s/93m5mz9w24)ã€‚ï¼‰

å°½ç®¡è¿™ä¸æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„æ¶ˆæ¯åº”ç”¨çš„UIï¼Œä½†å®ƒè¯´æ˜äº†åŒæ ·çš„è§‚ç‚¹ï¼š
å¦‚æœæˆ‘å‘é€ä¸€æ¡ç‰¹å®šçš„æ¶ˆæ¯ï¼Œç»„ä»¶ä¸åº”è¯¥å¯¹å®é™…å‘é€çš„æ˜¯å“ªæ¡æ¶ˆæ¯æ„Ÿåˆ°å›°æƒ‘ã€‚
è¿™ä¸ªå‡½æ•°ç»„ä»¶çš„messageå˜é‡æ•è·äº†â€œå±äºâ€è¿”å›äº†è¢«æµè§ˆå™¨è°ƒç”¨çš„å•å‡»å¤„ç†å‡½æ•°çš„é‚£ä¸€æ¬¡æ¸²æŸ“ã€‚æ‰€ä»¥å½“æˆ‘ç‚¹å‡»â€œå‘é€â€æ—¶messageè¢«è®¾ç½®ä¸ºé‚£ä¸€åˆ»åœ¨inputä¸­è¾“å…¥çš„å†…å®¹ã€‚

**è¯»è€…æ³¨ï¼šåœ¨è¾“å…¥æ¡†è¾“å…¥ä¸€äº›æ–‡å­—ï¼Œå†ç‚¹å‘é€æŒ‰é’®ï¼Œè¿™ä¸ªæ—¶å€™å³ä½¿æ”¹å˜è¾“å…¥çš„æ–‡å­—ï¼Œå‘å‡ºçš„æ•°æ®ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡è¾“å…¥çš„æ–‡å­—ï¼Œè€Œä¸æ˜¯åœ¨æ—¶é—´é—´éš”å†…æ”¹å˜çš„æ–‡å­—ã€‚**

---

å› æ­¤æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹Reactä¸­çš„å‡½æ•°ä¼šæ•è·propså’Œstateã€‚
ä½†æ˜¯å¦‚æœæˆ‘ä»¬æƒ³è¦è¯»å–çš„å¹¶ä¸æ˜¯ç¬¬ä¸€æ¬¡è¾“å…¥çš„æ•°æ®ï¼Œè€Œæ˜¯æ›´æ”¹åçš„ `props` å’Œ `state` å€¼å‘¢ï¼Ÿ

- åœ¨classç»„ä»¶ä¸­ï¼Œåªéœ€è¦é€šè¿‡è¯»å– `this.props` æˆ–è€… `this.state`, å› ä¸ºthisæœ¬èº«æ—¶å¯å˜çš„.
  ä¹Ÿå°±æ˜¯ä¸€å¼€å§‹ç¤ºä¾‹ä»£ç ä¸­è®¤ä¸ºclassç»„ä»¶å–å€¼é”™è¯¯âŒçš„æ—¶å€™ã€‚
- åœ¨å‡½æ•°å¼ç»„ä»¶ä¸­ï¼Œä½ ä¹Ÿå¯ä»¥æ‹¥æœ‰ä¸€ä¸ªåœ¨æ‰€æœ‰çš„ç»„ä»¶æ¸²æŸ“å¸§ä¸­å…±äº«çš„å¯å˜å˜é‡ã€‚å®ƒè¢«æˆä¸º `ref`;

é»˜è®¤æƒ…å†µä¸‹ï¼ŒReactä¸ä¼šåœ¨å‡½æ•°å¼ç»„ä»¶ä¸­ä¸ºæœ€æ–°çš„propså’Œstateåˆ›é€ refsã€‚åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œä½ å¹¶ä¸éœ€è¦å®ƒä»¬ï¼Œå¹¶ä¸”åˆ†é…å®ƒä»¬å°†æ˜¯ä¸€ç§æµªè´¹ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ æ„¿æ„ï¼Œä½ å¯ä»¥è¿™æ ·æ‰‹åŠ¨åœ°æ¥è¿½è¸ªè¿™äº›å€¼ï¼š

```
function MessageThread() {
  const [message, setMessage] = useState('');
  const latestMessage = useRef('');

  const showMessage = () => {
    alert('You said: ' + latestMessage.current);
  };

  const handleSendClick = () => {
    setTimeout(showMessage, 3000);
  };

  const handleMessageChange = (e) => {
    setMessage(e.target.value);
    latestMessage.current = e.target.value;
  };

  return (
    <>
      <input value={message} onChange={handleMessageChange} />
      <button onClick={handleSendClick}>Send</button>
    </>
  );
}
```

åœ¨è¾“å…¥æ¡†è¾“å…¥æ–‡å­—ï¼ŒæŒ‰ä¸‹æŒ‰é’®ä¹‹åï¼Œå³ä½¿å†æ¬¡æ”¹å˜è¾“å…¥æ¡†å†…çš„æ–‡å­—ï¼Œæœ€åè·å–çš„å€¼ä¹Ÿæ˜¯æ”¹å˜åçš„æœ€æ–°æ–‡å­—ã€‚

åªè·å–æŒ‰é’®è§¦å‘ä¹‹å‰å€¼çš„ [demo1](https://codesandbox.io/s/93m5mz9w24?file=/src/index.js)

åˆ©ç”¨`ref` è·å–æœ€æ–°å€¼çš„ [demo2](https://codesandbox.io/s/ox200vw8k9?file=/src/index.js:84-624)

é€šå¸¸æƒ…å†µä¸‹ï¼Œä½ åº”è¯¥é¿å…åœ¨æ¸²æŸ“æœŸé—´è¯»å–æˆ–è€…è®¾ç½® `refs` ï¼Œå› ä¸ºå®ƒä»¬æ˜¯å¯å˜å¾—ã€‚

æˆ‘ä»¬å¸Œæœ›ä¿æŒæ¸²æŸ“çš„å¯é¢„æµ‹æ€§ã€‚ç„¶è€Œï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦ç‰¹å®š `props` æˆ–è€… `state` çš„æœ€æ–°å€¼ï¼Œ

é‚£ä¹ˆæ‰‹åŠ¨æ›´æ–°refä¼šæœ‰äº›çƒ¦äººã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨ä¸€ä¸ª `effect` æ¥è‡ªåŠ¨åŒ–å®ç°å®ƒï¼š

```
function MessageThread() {
  const [message, setMessage] = useState('');

  // Keep track of the latest value.
  const latestMessage = useRef('');
  useEffect(() => {
    latestMessage.current = message;
  });

  const showMessage = () => {
    alert('You said: ' + latestMessage.current);
  };

  const handleSendClick = () => {
    setTimeout(showMessage, 3000);
  };

  const handleMessageChange = (e) => {
    setMessage(e.target.value);
  };

  return (
    <>
      <input value={message} onChange={handleMessageChange} />
      <button onClick={handleSendClick}>Send</button>
    </>
  );
}
```
[(è¿™æ˜¯demoã€‚)](https://codesandbox.io/s/yqmnz7xy8x?file=/src/index.js:94-692)

æˆ‘ä»¬åœ¨ä¸€ä¸ªeffectå†…éƒ¨æ‰§è¡Œèµ‹å€¼æ“ä½œä»¥ä¾¿è®©refçš„å€¼åªä¼šåœ¨DOMè¢«æ›´æ–°åæ‰ä¼šæ”¹å˜ã€‚è¿™ç¡®ä¿äº†æˆ‘ä»¬çš„å˜é‡çªå˜ä¸ä¼šç ´åä¾èµ–äºå¯ä¸­æ–­æ¸²æŸ“çš„ [æ—¶é—´åˆ‡ç‰‡å’Œ Suspense](https://zh-hans.reactjs.org/blog/2018/03/01/sneak-peek-beyond-react-16.html) ç­‰ç‰¹æ€§ã€‚

é€šå¸¸æ¥è¯´ä½¿ç”¨è¿™æ ·çš„refå¹¶ä¸æ˜¯éå¸¸åœ°å¿…è¦ã€‚æ•è·propså’Œstateé€šå¸¸æ˜¯æ›´å¥½çš„é»˜è®¤å€¼ã€‚

ç„¶è€Œï¼Œåœ¨å¤„ç†ç±»ä¼¼äºintervalså’Œè®¢é˜…è¿™æ ·çš„[å‘½ä»¤å¼API](https://overreacted.io/zh-hans/making-setinterval-declarative-with-react-hooks/)æ—¶ï¼Œrefä¼šååˆ†ä¾¿åˆ©ã€‚è®°ä½ï¼Œä½ å¯ä»¥åƒè¿™æ ·è·Ÿè¸ªä»»ä½•å€¼ â€”â€” ä¸€ä¸ªpropï¼Œä¸€ä¸ªstateå˜é‡ï¼Œæ•´ä¸ªpropså¯¹è±¡ï¼Œæˆ–è€…ç”šè‡³ä¸€ä¸ªå‡½æ•°ã€‚

----
> è½¬è½½æ•´ç†è‡³[åŸæ–‡](https://overreacted.io/zh-hans/how-are-function-components-different-from-classes/)