# React å‡½æ•°å¼ç»„ä»¶æ€§èƒ½ä¼˜åŒ–æŒ‡å—

æœ‰è¿‡ React å‡½æ•°å¼ç»„ä»¶çš„å®è·µï¼Œå¹¶ä¸”å¯¹ hooks æœ‰è¿‡å®è·µï¼Œå¯¹ useStateã€useCallbackã€useMemo API è‡³å°‘çœ‹è¿‡æ–‡æ¡£ï¼Œå¦‚æœä½ æœ‰è¿‡å¯¹ç±»ç»„ä»¶çš„æ€§èƒ½ä¼˜åŒ–ç»å†ï¼Œé‚£ä¹ˆè¿™ç¯‡æ–‡ç« ä¼šè®©ä½ æœ‰ç§ç†Ÿæ‚‰çš„æ„Ÿè§‰ã€‚

## React æ€§èƒ½ä¼˜åŒ–æ€è·¯

æˆ‘è§‰å¾— React æ€§èƒ½ä¼˜åŒ–çš„ç†å¿µçš„ä¸»è¦æ–¹å‘å°±æ˜¯è¿™ä¸¤ä¸ªï¼š

- å‡å°‘é‡æ–° `render` çš„æ¬¡æ•°ã€‚å› ä¸ºåœ¨ React é‡Œæœ€é‡(èŠ±æ—¶é—´æœ€é•¿)çš„ä¸€å—å°±æ˜¯ `reconction`(ç®€å•çš„å¯ä»¥ç†è§£ä¸º diff)ï¼Œå¦‚æœä¸ `render` ï¼Œå°±ä¸ä¼š `reconctionã€‚`

- å‡å°‘è®¡ç®—çš„é‡ã€‚ä¸»è¦æ˜¯å‡å°‘é‡å¤è®¡ç®—ï¼Œå¯¹äºå‡½æ•°å¼ç»„ä»¶æ¥è¯´ï¼Œæ¯æ¬¡ `render` éƒ½ä¼šé‡æ–°ä»å¤´å¼€å§‹æ‰§è¡Œå‡½æ•°è°ƒç”¨ã€‚

åœ¨ä½¿ç”¨ç±»ç»„ä»¶çš„æ—¶å€™ï¼Œä½¿ç”¨çš„ React ä¼˜åŒ– API ä¸»è¦æ˜¯ï¼š `shouldComponentUpdate` å’Œ `PureComponent` ï¼Œè¿™ä¸¤ä¸ª API æ‰€æä¾›çš„è§£å†³æ€è·¯éƒ½æ˜¯ä¸ºäº†å‡å°‘é‡æ–° render çš„æ¬¡æ•°ï¼Œä¸»è¦æ˜¯å‡å°‘çˆ¶ç»„ä»¶æ›´æ–°è€Œå­ç»„ä»¶ä¹Ÿæ›´æ–°çš„æƒ…å†µï¼Œè™½ç„¶ä¹Ÿå¯ä»¥åœ¨ state æ›´æ–°çš„æ—¶å€™é˜»æ­¢å½“å‰ç»„ä»¶æ¸²æŸ“ï¼Œå¦‚æœè¦è¿™ä¹ˆåšçš„è¯ï¼Œè¯æ˜ä½ è¿™ä¸ªå±æ€§ä¸é€‚åˆä½œä¸º stateï¼Œè€Œåº”è¯¥ä½œä¸ºé™æ€å±æ€§æˆ–è€…æ”¾åœ¨ class å¤–é¢ä½œä¸ºä¸€ä¸ªç®€å•çš„å˜é‡ ã€‚

ä½†æ˜¯åœ¨å‡½æ•°å¼ç»„ä»¶é‡Œé¢æ²¡æœ‰å£°æ˜å‘¨æœŸä¹Ÿæ²¡æœ‰ç±»ï¼Œé‚£å¦‚ä½•æ¥åšæ€§èƒ½ä¼˜åŒ–å‘¢ï¼Ÿ

## React.memo

é¦–å…ˆè¦ä»‹ç»çš„å°±æ˜¯` React.memo`ï¼Œè¿™ä¸ª API å¯ä»¥è¯´æ˜¯å¯¹æ ‡ç±»ç»„ä»¶é‡Œé¢çš„ `PureComponent` ï¼Œè¿™æ˜¯å¯ä»¥å‡å°‘é‡æ–° `render` çš„æ¬¡æ•°çš„ã€‚

ä¸¾ä¸ª ğŸŒ°

`useMemo` å¯ä»¥å¸®åŠ©æˆ‘ä»¬ä¼˜åŒ–å­ç»„ä»¶çš„æ¸²æŸ“ï¼Œæ¯”å¦‚è¿™ç§åœºæ™¯ï¼š
åœ¨ A ç»„ä»¶ä¸­æœ‰ä¸¤ä¸ªå­ç»„ä»¶ B å’Œ Cï¼Œå½“ A ç»„ä»¶ä¸­ä¼ ç»™ B çš„ `props` å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒA ç»„ä»¶çŠ¶æ€ä¼šæ”¹å˜ï¼Œé‡æ–°æ¸²æŸ“ã€‚æ­¤æ—¶ B å’Œ C ä¹Ÿéƒ½ä¼šé‡æ–°æ¸²æŸ“ã€‚å…¶å®è¿™ç§æƒ…å†µæ˜¯æ¯”è¾ƒæµªè´¹èµ„æºçš„ï¼Œç°åœ¨æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ `useMemo` è¿›è¡Œä¼˜åŒ–ï¼ŒB ç»„ä»¶ç”¨åˆ°çš„ `props` å˜åŒ–æ—¶ï¼Œåªæœ‰ B å‘ç”Ÿæ”¹å˜ï¼Œè€Œ C å´ä¸ä¼šé‡æ–°æ¸²æŸ“ã€‚

```
const CompA = (props)  => {
	console.log('CompA', props)
	return <h2 style={{color: `red`}}>Comp A {props.text}</h2>
}

const CompB = (props)  => {
	console.log('CompB', props)
	return <h2 style={{color: `blue`}}>Comp B {props.text}</h2>
}

const CompAandB = (props)  => {
	const [count , setCount] = useState(0)
	const [a, setA] = useState('ExampleA');
	const [b, setB] = useState('ExampleB');

	function clickA() {
		setCount(count + 1)
		setA('ä¿®æ”¹åçš„ ExampleA' + count)
	}

	function clickB() {
		setCount(count + 1)
		setB('ä¿®æ”¹åçš„ ExampleB' + count)
	}

  // åˆ©ç”¨useMemoè¿›è¡Œä¼˜åŒ–ï¼š
	const exampleA = useMemo(() => <CompA text={ a } />, [a]);
  const exampleB = useMemo(() => <CompB text={ b } />, [b]);

	return (
		<div>
			{exampleA}
			{exampleB}
			<br />
			<button type="primary" onClick={clickA}>æˆ‘æ˜¯AæŒ‰é’®</button>
			<br />
			<button type="primary" onClick={clickB}>æˆ‘æ˜¯BæŒ‰é’®</button>
		</div>
	)
}
```
## React.memo é«˜çº§ç”¨æ³•

é»˜è®¤æƒ…å†µä¸‹å…¶åªä¼šå¯¹ `props` çš„å¤æ‚å¯¹è±¡åšæµ…å±‚å¯¹æ¯”(æµ…å±‚å¯¹æ¯”å°±æ˜¯åªä¼šå¯¹æ¯”å‰åä¸¤æ¬¡ `props` å¯¹è±¡å¼•ç”¨æ˜¯å¦ç›¸åŒï¼Œä¸ä¼šå¯¹æ¯”å¯¹è±¡é‡Œé¢çš„å†…å®¹æ˜¯å¦ç›¸åŒ)ï¼Œå¦‚æœä½ æƒ³è¦æ§åˆ¶å¯¹æ¯”è¿‡ç¨‹ï¼Œé‚£ä¹ˆè¯·å°†è‡ªå®šä¹‰çš„æ¯”è¾ƒå‡½æ•°é€šè¿‡ç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥æ¥å®ç°ã€‚

```
function MyComponent(props) {
  /* ä½¿ç”¨ props æ¸²æŸ“ */
}
function areEqual(prevProps, nextProps) {
  /*
  å¦‚æœæŠŠ nextProps ä¼ å…¥ render æ–¹æ³•çš„è¿”å›ç»“æœä¸
  å°† prevProps ä¼ å…¥ render æ–¹æ³•çš„è¿”å›ç»“æœä¸€è‡´åˆ™è¿”å› trueï¼Œ
  å¦åˆ™è¿”å› false
  */
}
exportdefault React.memo(MyComponent, areEqual);
```

å¦‚æœä½ æœ‰åœ¨ç±»ç»„ä»¶é‡Œé¢ä½¿ç”¨è¿‡ `shouldComponentUpdate()`[2] è¿™ä¸ªæ–¹æ³•ï¼Œä½ ä¼šå¯¹ `React.memo` çš„ç¬¬äºŒä¸ªå‚æ•°éå¸¸çš„ç†Ÿæ‚‰ï¼Œä¸è¿‡å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœ `props` ç›¸ç­‰ï¼Œ `areEqual` ä¼šè¿”å› trueï¼›å¦‚æœ `props` ä¸ç›¸ç­‰ï¼Œåˆ™è¿”å› falseã€‚è¿™ä¸ `shouldComponentUpdate` æ–¹æ³•çš„è¿”å›å€¼ç›¸åã€‚


## useCallback

`useCallback` ä¸ `useMemo` è¿™ä¸¤ä¸ªapiï¼Œå…¶å®æ¦‚å¿µä¸Šè¿˜æ˜¯å¾ˆå¥½ç†è§£çš„ï¼Œä¸€ä¸ªæ˜¯ã€Œç¼“å­˜å‡½æ•°ã€ï¼Œ ä¸€ä¸ªæ˜¯ç¼“å­˜ã€Œå‡½æ•°çš„è¿”å›å€¼ã€ã€‚

hookså¯¹ã€Œæœ‰æ²¡æœ‰å˜åŒ–ã€è¿™ä¸ªç‚¹å…¶å®å¾ˆæ•æ„Ÿã€‚å¦‚æœä¸€ä¸ªeffectå†…éƒ¨ä½¿ç”¨äº†æŸæ•°æ®æˆ–è€…æ–¹æ³•ã€‚è‹¥æˆ‘ä»¬ä¾èµ–é¡¹ä¸åŠ ä¸Šå®ƒï¼Œé‚£å¾ˆå®¹æ˜“ç”±äºé—­åŒ…é—®é¢˜ï¼Œå¯¼è‡´æ•°æ®æˆ–æ–¹æ³•ï¼Œéƒ½ä¸æ˜¯æˆ‘ä»¬ç†æƒ³ä¸­çš„é‚£ä¸ªå®ƒã€‚å¦‚æœæˆ‘ä»¬åŠ ä¸Šå®ƒï¼Œå¾ˆå¯èƒ½åˆä¼šç”±äºä»–ä»¬çš„å˜åŠ¨ï¼Œå¯¼è‡´effectç–¯ç‹‚çš„æ‰§è¡Œã€‚çœŸå®å¼€å‘çš„è¯ï¼Œå¤§å®¶åº”è¯¥ä¼šç»å¸¸é‡åˆ°è¿™ç§é—®é¢˜ã€‚

æ‰€ä»¥ï¼Œåœ¨æ­¤å»ºè®®ï¼š

- åœ¨ç»„ä»¶å†…éƒ¨ï¼Œé‚£äº›ä¼šæˆä¸ºå…¶ä»– `useEffect` ä¾èµ–é¡¹çš„æ–¹æ³•ï¼Œå»ºè®®ç”¨ `useCallback` `åŒ…è£¹ï¼Œæˆ–è€…ç›´æ¥ç¼–å†™åœ¨å¼•ç”¨å®ƒçš„useEffect` ä¸­ã€‚
- å·±æ‰€ä¸æ¬²å‹¿æ–½äºäººï¼Œå¦‚æœä½ çš„ function ä¼šä½œä¸º props ä¼ é€’ç»™å­ç»„ä»¶ï¼Œè¯·ä¸€å®šè¦ä½¿ç”¨ `useCallback` åŒ…è£¹ï¼Œå¯¹äºå­ç»„ä»¶æ¥è¯´ï¼Œå¦‚æœæ¯æ¬¡ `render` éƒ½ä¼šå¯¼è‡´ä½ ä¼ é€’çš„å‡½æ•°å‘ç”Ÿå˜åŒ–ï¼Œå¯èƒ½ä¼šå¯¹å®ƒé€ æˆéå¸¸å¤§çš„å›°æ‰°ã€‚åŒæ—¶ä¹Ÿä¸åˆ©äº react åšæ¸²æŸ“ä¼˜åŒ–



> [React å®˜ç½‘](https://zh-hans.reactjs.org/docs/react-api.html#reactmemo)

> [å†™React Hookså‰å¿…è¯»](https://zhuanlan.zhihu.com/p/113216415?utm_source=tuicool&utm_medium=referral)

> [æµ…è°ˆReactæ€§èƒ½ä¼˜åŒ–çš„æ–¹å‘](https://juejin.im/post/5d045350f265da1b695d5bf2#heading-0)

